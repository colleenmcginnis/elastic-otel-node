////
Goal of this doc:
The user is able to successfully see data from their Node application make it to the Elastic UI via the Elastic Distribution for OpenTelemetry Node.js

Assumptions we're comfortable making about the reader:
- They know what both Elastic and OpenTelemetry are
- They have Node and NPM installed
////

[[get-started]]
== Get started

:language: Node.js
:distro_name: Elastic Distribution for OpenTelemetry {language}

include::release-status.asciidoc[]

This guide shows you how to use the Elastic Distribution for OpenTelemetry {language} ("the distro") to instrument your {language} application and send OpenTelemetry data to an Elastic Observability deployment.

[NOTE]
====
As an OpenTelemetry SDK, the distro supports sending data to any OpenTelemetry protocol (OTLP) endpoint (for example, an https://opentelemetry.io/docs/collector/[OpenTelemetry Collector]).
====

////
What does a user need to know and/or do before they install the distro?
////
[discrete]
[[get-started-prereq]]
=== Prerequisites

Before getting started:

// Familiarity with OpenTelemetry
* *Familiarize yourself with the OpenTelemetry SDK.* The distro is a lightweight wrapper around the OpenTelemetry SDK. You should be broadly familiar with the OpenTelemetry SDK concepts and instrumenting applications using the Microsoft diagnostic APIs. If you are not familiar with this, start with the https://opentelemetry.io/docs/languages/net[OpenTelemetry SDK documentation].
+
// Any dependencies (including supported versions)
* *Check your Node.js version*.
include::supported-technologies.asciidoc[tag=node-version]
+
* *Set up Elastic Observability*. You'll need somewhere to send the gathered OpenTelemetry data, so it can be viewed and analyzed. While the `@elastic/opentelemetry-node` package supports sending to any OTLP endpoint, this doc assumes you're using Elastic Observability. You can use an existing Elastic deployment that uses version 7.14 or higher or set up a new one.
+
[[elastic-observability-setup]]
[%collapsible]
.*Expand for setup instructions*
====
This section shows how to create an https://www.elastic.co/observability[Elastic Observability] cloud deployment and get the data you need to configure the distro to send data to it.

. Register at https://cloud.elastic.co/registration[cloud.elastic.co], if you haven't already. This supports starting **free trial**.
. After registering, click "Create deployment" at `<https://cloud.elastic.co/home>`.  Once that is created, click "Open" to visit your Kibana home page, e.g. `https://{DEPLOYMENT_NAME}.kb.{REGION}.cloud.es.io/app/home#/getting_started`.
====

////
Other prereqs?
////

////
How does a user install the distro?
////
[discrete]
[[get-started-install]]
=== Install

////
Step-by-step instructions
////
Install the `@elastic/opentelemetry-node` package:

[source,sh]
----
npm install --save @elastic/opentelemetry-node
----

The distro is a single package that includes all the OpenTelemetry JS packages
that are needed for most cases.

// TODO: refer to advanced section of "start the SDK" when we have that doc.

////
Any additional info related to installation
Is this relevant to the Node distro?
////
[NOTE]
.The Elastic distro and the OpenTelemetry SDK
====
The distro includes a transitive dependency on the OpenTelemetry SDK, so you do not _need_ to add the OpenTelemetry SDK package to your project directly. However, you _can_ explicitly add the OpenTelemetry SDK as a dependency if you want to opt into newer SDK versions. If you do this, the OpenTelemetry SDK dependency must
be defined _before_ the {distro_name} is defined.
====

////
Are there any configuration options that are _required_?
What does the _minimal_ configuration / set up look like?
What should they expect to see after setting up and running the distro?
How do they know it worked as expected?
////
[discrete]
[[get-started-send-data-to-Elastic]]
=== Send data to Elastic

After installing the distro, configure and initialize it to start
sending data to Elastic.

[discrete]
[[get-started-configure]]
==== Configure the distro

To configure the distro you'll need the deployment's OTLP endpoint and
authorization data to set the appropriate `OTLP_*` environment variables:

include::configure.asciidoc[tag=minimal-options]

When sending data to Elastic, you can find the values of these variables in Kibana's APM tutorial.
In Kibana:

. Search for _APM Tutorial_
. Scroll down to the _APM Agents_ section and select the *OpenTelemetry* tab
. The appropriate values for `OTEL_EXPORTER_OTLP_ENDPOINT` and
`OTEL_EXPORTER_OTLP_HEADERS` are shown there
+
For example:
+
[source,sh]
----
export OTEL_EXPORTER_OTLP_ENDPOINT=https://my-deployment.apm.us-west1.gcp.cloud.es.io
export OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer P....l"
----

image::img/otlp-endpoint-settings.png[Kibana's APM tutorial showing OTel settings]

[NOTE]
====
For more information on authentication methods, refer to <<configure-auth-methods>>.
====

[discrete]
[[get-started-initialization]]
==== Initialize the distro

For the distro to automatically instrument modules used by your Node.js service,
it must be started before you `require` your service code's dependencies --
for example, before `express` or `http` are loaded.

The recommended way to get the
distro started is by using the `-r, --require` Node.js
https://nodejs.org/api/cli.html#-r---require-module[CLI option]:

[source,sh]
----
node --require @elastic/opentelemetry-node my-service.js
----

The distro will automatically instrument popular modules (listed in <<supported-technologies>>)
used by your service, and send traces, metrics, and logs telemetry data (using
OTLP) to your configured observability backend.

// TODO: link to a reference section on other ways to start the distro once we have those docs.

[discrete]
[[get-started-asp-net-core-view-traces]]
=== View traces

To view traces, you can use the Elastic APM UI:

////
Step-by-step instructions
////


////
What should they do next?
////
[discrete]
[[get-started-next-steps]]
=== Next steps

////
// Examples:
//
// See all configuration options
// Learn more about interpreting data
// Other
////

:!language:
:!distro_name:
